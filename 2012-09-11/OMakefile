dirs = $(FindDirs ./)

TEXDEPS = $(filter %out.tex, $(set $(ls ./*/)))

out.tex : :value: $(TEXDEPS)
	section
		fp = $(fopen $@, w)
		fprintln($(fp), \input{../tmpl/head.tex})
		foreach(dir, $(dirs))
			fprintln($(fp), \part{})
			fprintln($(fp), \setcounter{section}{0})
			fprintln($(fp), \input{$(dir)/out.tex})
		fprintln($(fp), \input{../tmpl/end.tex})

LaTeXDocument(out, out)

.DEFAULT: out.pdf
.SUBDIRS: 1 2 3
